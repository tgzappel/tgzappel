<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Grandmaster Zone | Leaderboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav><a href="index.html">LEVEL LIST</a><a href="leaderboard.html">LEADERBOARD</a></nav>
    <div id="container">
        <h1>TOP PLAYERS</h1>
        <div class="search-container">
            <input type="text" id="searchBar" placeholder="Search players..." onkeyup="filterPlayers()">
        </div>
        <div id="leaderboard-view"></div>
    </div>
    <div id="infoModal" class="modal"><div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <div id="modal-body"></div>
    </div></div>

    <script src="data.js"></script>
    <script>
        let leaderboard = [];

        function calculateLeaderboard() {
            leaderboard = DATA.players.map(p => {
                let total = 0;
                p.completions.forEach(id => {
                    const lvl = DATA.levels.find(l => l.id === id);
                    if (lvl) total += lvl.points;
                });
                return { ...p, total };
            }).sort((a, b) => b.total - a.total);
        }

        function renderLeaderboard(filter = "") {
            const view = document.getElementById('leaderboard-view');
            const filtered = leaderboard.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));

            view.innerHTML = filtered.map((p, i) => `
                <div class="player-row" onclick="showPlayerDetails('${p.name}')">
                    <span style="font-weight:bold">#${i + 1} &nbsp; ${p.name}</span>
                    <span class="score">${p.total} pts</span>
                </div>`).join('');
        }

        function filterPlayers() {
            const query = document.getElementById('searchBar').value;
            renderLeaderboard(query);
        }

        function showPlayerDetails(name) {
            const p = leaderboard.find(player => player.name === name);
            const beaten = p.completions.map(id => {
                const found = DATA.levels.find(l => l.id === id);
                return found ? found.name : "Unknown Level";
            });
            const content = `
                <h2 style="color:var(--gold); margin-bottom:10px;">${p.name}</h2>
                <p><strong>Total Points:</strong> ${p.total}</p>
                <hr style="border:0; border-top:1px solid #333; margin:20px 0;">
                <h3>Completions (${beaten.length}):</h3>
                <ul style="max-height:300px; overflow-y:auto;">${beaten.map(l => `<li>${l}</li>`).join('')}</ul>`;
            openModal(content);
        }

        function openModal(c) { document.getElementById('modal-body').innerHTML = c; document.getElementById('infoModal').style.display = "block"; }
        function closeModal() { document.getElementById('infoModal').style.display = "none"; }

        calculateLeaderboard();
        renderLeaderboard();
    </script>
</body>
</html>
