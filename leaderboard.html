<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard | Grandmaster List</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <a href="index.html">LEVELS</a>
        <a href="leaderboard.html" class="active">LEADERBOARD</a>
    </nav>

    <div id="container">
        <h1>TOP PLAYERS</h1>
        
        <table class="leaderboard-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Player</th>
                    <th>Completions</th>
                    <th>Total Points</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                </tbody>
        </table>
    </div>

    <script src="./data.js"></script>

    <script>
        let leaderboard = [];

        function calculateLeaderboard() {
            if (!window.DATA || !window.DATA.players || !window.DATA.levels) return;

            // Map players to their total scores
            leaderboard = DATA.players.map(player => {
                let totalPoints = 0;
                
                player.completions.forEach(id => {
                    // Finds the level by ID and adds its points (Column I / Index 8)
                    const level = DATA.levels.find(l => l.id.toLowerCase() === id.toLowerCase());
                    if (level) {
                        totalPoints += level.points;
                    }
                });

                return {
                    name: player.name,
                    count: player.completions.length,
                    points: totalPoints
                };
            });

            // Sort: highest points first
            leaderboard.sort((a, b) => b.points - a.points);
            renderLeaderboard();
        }

        function renderLeaderboard() {
            const lbBody = document.getElementById('leaderboard-body');
            if (!lbBody) return;

            if (leaderboard.length === 0) {
                lbBody.innerHTML = `<tr><td colspan="4" style="text-align:center; padding:20px;">No players found.</td></tr>`;
                return;
            }

            lbBody.innerHTML = leaderboard.map((player, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td><strong>${player.name}</strong></td>
                    <td>${player.count}</td>
                    <td style="color:var(--gold); font-weight:bold;">${player.points.toLocaleString()}</td>
                </tr>
            `).join('');
        }

        // The data.js script calls calculateLeaderboard() automatically once the CSVs load!
    </script>
</body>
</html>
