<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <a href="index.html"><img src="The.png" class="nav-logo"></a>
        <div class="nav-links">
            <a href="index.html" class="active">Levels</a>
            <a href="leaderboard.html">Leaderboard</a>
        </div>
    </nav>

    <div id="main-layout">
        <main>
            <input type="text" id="searchBar" placeholder="Search levels..." onkeyup="filterLevels()" style="width:100%; padding:15px; border-radius:12px; border:1px solid #ddd; margin-bottom:20px;">
            <div id="list-view"></div>
        </main>

        <aside id="sidebar">
            <h3 style="font-size:0.7rem; color:var(--text-muted); text-transform:uppercase; margin-bottom:10px;">Filter Skills</h3>
            <div id="tag-filters">
                <button class="tag-btn" onclick="toggleTag('Blues')">Blues</button>
                <button class="tag-btn" onclick="toggleTag('Chokepoint')">Chokepoint</button>
                <button class="tag-btn" onclick="toggleTag('Crouch Spam')">Crouch Spam</button>
                <button class="tag-btn" onclick="toggleTag('Crumble')">Crumble</button>
                <button class="tag-btn" onclick="toggleTag('Crusher')">Crusher</button>
                <button class="tag-btn" onclick="toggleTag('Endurance')">Endurance</button>
                <button class="tag-btn" onclick="toggleTag('Gerald Gameplay')">Gerald Gameplay</button>
                <button class="tag-btn" onclick="toggleTag('Kaizo')">Kaizo</button>
                <button class="tag-btn" onclick="toggleTag('Keydoor')">Keydoor</button>
                <button class="tag-btn" onclick="toggleTag('Litejumps')">Litejumps</button>
                <button class="tag-btn" onclick="toggleTag('Memory')">Memory</button>
                <button class="tag-btn" onclick="toggleTag('Mob')">Mob</button>
                <button class="tag-btn" onclick="toggleTag('Momentum Control')">Momentum Control</button>
                <button class="tag-btn" onclick="toggleTag('Needle Gameplay')">Needle Gameplay</button>
                <button class="tag-btn" onclick="toggleTag('Precision')">Precision</button>
                <button class="tag-btn" onclick="toggleTag('Routing')">Routing</button>
                <button class="tag-btn" onclick="toggleTag('Sidejumps')">Sidejumps</button>
                <button class="tag-btn" onclick="toggleTag('Speedrun')">Speedrun</button>
                <button class="tag-btn" onclick="toggleTag('Spikedges')">Spikedges</button>
                <button class="tag-btn" onclick="toggleTag('Strategy')">Strategy</button>
                <button class="tag-btn" onclick="toggleTag('Technical')">Technical</button>
                <button class="tag-btn" onclick="toggleTag('Trampoline')">Trampoline</button>
                <button class="tag-btn" onclick="toggleTag('Walljumps')">Walljumps</button>
            </div>
        </aside>
    </div>

    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span onclick="closeModal()" style="position:absolute; right:20px; top:15px; cursor:pointer; font-size:24px;">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        let activeTags = [];
        function renderLevels() { filterLevels(); }
        function toggleTag(tag) {
            event.currentTarget.classList.toggle('active-tag');
            activeTags.includes(tag) ? activeTags = activeTags.filter(t => t !== tag) : activeTags.push(tag);
            filterLevels();
        }

        function getStatColor(val) {
            const num = parseFloat(String(val).split('/')[0]);
            if (isNaN(num)) return "#86868b";
            if (num <= 25) return "#800000"; if (num <= 45) return "#cc0000"; 
            if (num <= 65) return "#e6ac00"; if (num <= 85) return "#2eb82e"; return "#00cc44";
        }

        function filterLevels() {
            const search = document.getElementById('searchBar').value.toLowerCase();
            const filtered = DATA.levels.filter(lvl => {
                const match = lvl.name.toLowerCase().includes(search) || lvl.author.toLowerCase().includes(search);
                const tags = activeTags.length === 0 || activeTags.every(t => lvl.skills.includes(t));
                return match && tags;
            });
            document.getElementById('list-view').innerHTML = filtered.map((lvl, i) => `
                <div class="level-entry" onclick="showLevelDetails('${lvl.id}')">
                    <img class="level-thumb" src="${lvl.img}">
                    <div class="level-rank">#${i + 1}</div>
                    <div class="level-info"><div class="level-name">${lvl.name}</div><div class="level-meta">by ${lvl.author}</div></div>
                    <div class="level-points">${lvl.points}pts</div>
                </div>`).join('');
        }

        function showLevelDetails(id) {
            const lvl = DATA.levels.find(l => l.id === id);
            const victors = DATA.players.filter(p => p.completions.includes(id));
            document.getElementById('modal-body').innerHTML = `
                <div style="width:100%; aspect-ratio:4/3; overflow:hidden; border-radius:15px; margin-bottom:20px;">
                    <img src="${lvl.img}" style="width:100%; height:100%; object-fit:cover;">
                </div>
                <h2>${lvl.name}</h2><p>By ${lvl.author}</p>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin:20px 0;">
                    <div style="background:#f5f5f7; padding:10px; border-radius:10px;">Enjoyment: <b style="color:${getStatColor(lvl.enjoyment)}">${lvl.enjoyment}</b></div>
                    <div style="background:#f5f5f7; padding:10px; border-radius:10px;">Quality: <b style="color:${getStatColor(lvl.quality)}">${lvl.quality}</b></div>
                    <div style="background:#f5f5f7; padding:10px; border-radius:10px;">Skill/Effort: <b>${lvl.ratio}</b></div>
                    <div style="background:#f5f5f7; padding:10px; border-radius:10px;">Verifier: <b>${lvl.verifier}</b></div>
                </div>
                <p>${lvl.desc || ""}</p>
                <hr><p><b>Victors:</b> ${victors.map(v => v.name).join(', ') || "None"}</p>
            `;
            document.getElementById('infoModal').style.display = "block";
            document.body.style.overflow = "hidden";
        }
        function closeModal() { document.getElementById('infoModal').style.display="none"; document.body.style.overflow="auto"; }
    </script>
</body>
</html>
